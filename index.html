<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ESP32 Health Monitor</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: #f5f5dc;
      font-family: 'Segoe UI', sans-serif;
      color: #003366;
      text-align: center;
      padding: 30px 10px;
    }

    .card {
      background: #e0f7fa;
      border: 2px solid #003366;
      border-radius: 20px;
      padding: 30px;
      width: 300px;
      margin: auto;
      margin-bottom: 30px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .charts-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    canvas {
      width: 100%;
      max-width: 350px;
      height: 250px !important;
    }
  </style>
</head>
<body>

  <h1>ESP32 Real-Time Health Monitor (ThingSpeak)</h1>

  <div class="card">
    üå°Ô∏è Temperature: <span id="temp">--</span> ¬∞C<br><br>
    üíì Pulse: <span id="pulse">--</span> bpm
  </div>

  <div class="charts-container">
    <canvas id="tempChart"></canvas>
    <canvas id="pulseChart"></canvas>
  </div>

  <script>
    const channelId = "3015599"; // üîÅ Replace this with your channel ID
    const apiKey = "L9QFBQ1PLNRLEZ80";

    const labels = [];
    const tempData = [];
    const pulseData = [];

    const tempChart = new Chart(document.getElementById("tempChart"), {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "Temperature (¬∞C)",
          data: tempData,
          borderColor: "#0077b6",
          backgroundColor: "rgba(0,119,182,0.1)",
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        animation: false,
        scales: {
          x: { title: { display: true, text: "Time" } },
          y: { title: { display: true, text: "¬∞C" }, suggestedMin: 20, suggestedMax: 40 }
        }
      }
    });

    const pulseChart = new Chart(document.getElementById("pulseChart"), {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "Pulse (bpm)",
          data: pulseData,
          borderColor: "#e63946",
          backgroundColor: "rgba(230,57,70,0.1)",
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        animation: false,
        scales: {
          x: { title: { display: true, text: "Time" } },
          y: { title: { display: true, text: "BPM" }, suggestedMin: 50, suggestedMax: 120 }
        }
      }
    });

    async function fetchFromThingSpeak() {
      try {
        const url = `https://api.thingspeak.com/channels/${channelId}/feeds.json?results=30&api_key=${apiKey}`;
        const res = await fetch(url);
        const data = await res.json();

        labels.length = 0;
        tempData.length = 0;
        pulseData.length = 0;

        const feeds = data.feeds;

        for (const feed of feeds) {
          const time = new Date(feed.created_at).toLocaleTimeString();
          const temp = parseFloat(feed.field1);
          const pulse = parseFloat(feed.field2);

          if (!isNaN(temp) && !isNaN(pulse)) {
            labels.push(time);
            tempData.push(temp);
            pulseData.push(pulse);
          }
        }

        document.getElementById("temp").textContent = tempData[tempData.length - 1];
        document.getElementById("pulse").textContent = pulseData[pulseData.length - 1];

        tempChart.update();
        pulseChart.update();
      } catch (e) {
        console.error("ThingSpeak fetch failed:", e);
      }
    }

    setInterval(fetchFromThingSpeak, 5000);
    fetchFromThingSpeak();
  </script>

</body>
</html>
